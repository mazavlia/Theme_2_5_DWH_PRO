# Тема 2.5 "Витрины данных".
# Задание PRO. 

```
При работе по сбору витрины для анализа эффективности плана продаж, к вам обратился ваш руководитель 
и сообщил, что надо обязательно к схеме данных добавить таблицу о промо-акциях на те или иные товары,
иначе финальная витрина будет недостаточно информативной. Таким образом, в вашей схеме появляется 
новая таблица - promo, которая содержит информацию о том: в каком магазине, в какой день, на какой 
продукт и какого размера была скидка.
Вам также нужно к итоговой витрине которую вы получили при выполнении базового задания, добавить 
несколько новых атрибутов:

- avg(sales/date) - среднее количество продаж в день,
- max_sales - максимальное количество продаж за один день,
- date_max_sales - день, в который произошло максимальное количество продаж,
- date_max_sales_is_promo - факт того, действовала ли скидка в тот день, когда произошло максимальное
количество продаж,
- avg(sales/date) / max_sales - отношение среднего количества продаж к максимальному,
- promo_len - количество дней месяце когда на товар действовала скидка,
- promo_sales_cnt - количество товаров проданных в дни скидок,
- promo_sales_cnt/fact_sales - отношение количества товаров проданных в дни скидки к общему количеству
проданных товаров за месяц,
- promo_income - доход с продаж в дни акций,
- promo_income/fact_income - отношение дохода с продаж в дни акций к общему доходу с продаж за месяц
```

## Логическая структура базы данных:

![Logic structure](retail_structure.png)

## Графическая структура базы данных:

![Graphic structure](retail_structure_dbeaver.png)


### 1. SQL-скрипт для создания таблиц:
Файл: [DDL-script](sql_scripts/ddl/1_ddl.sql)

### 2. SQL-скрипт для заполения таблиц:
Файл: [DML-script](sql_scripts/dml/2_dml.sql)

### 3. SQL-скрипт витрины данных:
Файл: [Data mart script](sql_scripts/3_data_mart.sql)

### 4. Файл Docker-compose:
Файл: [Docker-compose](docker-compose.yml)


### Для развертывания базы "Планирование продаж" необходимо:
1. Скачать архив из репозитория;
2. Распаковать в нужную папку;
3. В терминале перейти в папку с базой данных и выполнить команду ***docker-compose up -d***;
4. Запустить DBeaver, port 5436, наименование базы данных (sales_planning_pro), логин (postgres), пароль (password);
5. Посмотреть результаты отработанного скрипта 3_data_mart.sql можно в DBeaver'е, запустив каждую задачу последовательно, или посмотреть логи командой: ***docker logs sales_planning***.